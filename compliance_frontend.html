<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆè§„æ™ºèƒ½ä½“ - å†…å®¹å®¡æ ¸ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
        }

        /* Ant Design æ ‡ç­¾é¡µæ ·å¼ */
        .tabs {
            display: flex;
            margin-bottom: 24px;
            border-bottom: 1px solid #f0f0f0;
            position: relative;
        }

        .tab {
            position: relative;
            display: inline-flex;
            align-items: center;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 500;
            color: rgba(0, 0, 0, 0.65);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: color 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);
            outline: none;
            margin-right: 32px;
        }

        .tab:hover {
            color: #1890ff;
        }

        .tab.active {
            color: #1890ff;
            font-weight: 500;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: #1890ff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* å¯¹æ¯”è§†å›¾ */
        .comparison-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-panel {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .comparison-panel h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .comparison-panel.original {
            border-color: #ff9800;
        }

        .comparison-panel.modified {
            border-color: #4caf50;
        }


        /* é«˜äº®å¯ç‚¹å‡» */
        .highlight-clickable {
            background: #ffebee;
            color: #c62828;
            padding: 2px 4px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .highlight-clickable:hover {
            background: #ffcdd2;
            box-shadow: 0 2px 8px rgba(198, 40, 40, 0.3);
        }

        .highlight-success {
            background: #d4edda;
            color: #155724;
            padding: 2px 4px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .highlight-success:hover {
            background: #c3e6cb;
            box-shadow: 0 2px 8px rgba(21, 87, 36, 0.3);
        }

        .highlight-clickable.active,
        .highlight-success.active {
            background: #1890ff;
            color: #fff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        /* æ‰‹åŠ¨ç¼–è¾‘åŒºåŸŸ */
        .manual-edit-section {
            background: #f0f7ff;
            padding: 10px 12px;
            border-radius: 4px;
            margin-top: 10px;
            border-left: 3px solid #1890ff;
        }

        .manual-edit-section strong {
            display: block;
            margin-bottom: 8px;
            color: #1890ff;
            font-size: 13px;
        }

        .manual-edit-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 2px;
            font-size: 14px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        .manual-edit-input:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        .manual-edit-textarea {
            width: 100%;
            min-height: 60px;
            padding: 8px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 2px;
            font-size: 14px;
            margin-bottom: 10px;
            resize: vertical;
            box-sizing: border-box;
            font-family: inherit;
        }

        .manual-edit-textarea:focus {
            outline: none;
            border-color: #1890ff;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        /* åˆ†ç±»æ ‡ç­¾æ ·å¼ */
        .category-tag {
            display: flex;
            align-items: center;
            padding: 8px 16px;
            border: 1px solid #d9d9d9;
            border-radius: 2px;
            background: #fff;
            cursor: pointer;
            transition: all 0.2s;
        }

        .category-tag:hover {
            border-color: #1890ff;
            color: #1890ff;
        }

        .category-tag input[type="radio"] {
            margin-right: 8px;
            cursor: pointer;
        }

        .category-tag input[type="radio"]:checked + span {
            color: #1890ff;
            font-weight: 500;
        }

        .category-tag:has(input[type="radio"]:checked) {
            border-color: #1890ff;
            background: #e6f7ff;
        }

        /* ä¿®æ”¹å†…å®¹é«˜äº® */
        .modified-highlight {
            background: #d4edda;
            color: #155724;
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: 500;
        }

        .deleted-highlight {
            background: #f8d7da;
            color: #721c24;
            text-decoration: line-through;
            padding: 2px 4px;
            border-radius: 2px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px 40px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
        }

        .nav-tab {
            padding: 10px 24px;
            background: transparent;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            transition: all 0.3s;
        }

        .nav-tab:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .nav-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* é¡µé¢å†…å®¹åŒºåŸŸ */
        .page-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            min-height: calc(100vh - 200px);
        }

        .page-content.active {
            display: block;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .page-desc {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
        }

        /* çŸ¥è¯†åº“ä¸Šä¼ é¡µé¢ */
        .upload-section {
            margin-bottom: 30px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 12px;
            padding: 60px 40px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #764ba2;
        }

        .upload-area.dragover {
            background: rgba(102, 126, 234, 0.2);
            border-color: #764ba2;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 18px;
            color: #667eea;
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 14px;
            color: #999;
        }

        .file-input {
            display: none;
        }

        .file-list {
            margin-top: 20px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f5f5f5;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .file-icon {
            font-size: 24px;
        }

        .file-details {
            display: flex;
            flex-direction: column;
        }

        .file-name {
            font-weight: 600;
            color: #333;
        }

        .file-size {
            font-size: 12px;
            color: #999;
        }

        .file-actions {
            display: flex;
            gap: 10px;
        }

        /* Ant Design æŒ‰é’®è§„èŒƒ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 32px;
            padding: 4px 15px;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.5715;
            border: 1px solid #d9d9d9;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);
            user-select: none;
            touch-action: manipulation;
            white-space: nowrap;
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.015);
        }

        .btn:focus {
            outline: 0;
        }

        .btn:not(:disabled):active {
            transform: translateY(1px);
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.015);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Primary æŒ‰é’® - ä¸»è¦æ“ä½œ */
        .btn-primary {
            background: #1890ff;
            border-color: #1890ff;
            color: #fff;
        }

        .btn-primary:hover:not(:disabled) {
            background: #40a9ff;
            border-color: #40a9ff;
        }

        .btn-primary:active:not(:disabled) {
            background: #096dd9;
            border-color: #096dd9;
        }

        /* Success æŒ‰é’® - æˆåŠŸæ“ä½œ */
        .btn-success {
            background: #52c41a;
            border-color: #52c41a;
            color: #fff;
        }

        .btn-success:hover:not(:disabled) {
            background: #73d13d;
            border-color: #73d13d;
        }

        .btn-success:active:not(:disabled) {
            background: #389e0d;
            border-color: #389e0d;
        }

        /* Default æŒ‰é’® - é»˜è®¤æ“ä½œ */
        .btn-default {
            background: #fff;
            border-color: #d9d9d9;
            color: rgba(0, 0, 0, 0.85);
        }

        .btn-default:hover:not(:disabled) {
            color: #1890ff;
            border-color: #1890ff;
        }

        .btn-default:active:not(:disabled) {
            color: #096dd9;
            border-color: #096dd9;
        }

        /* Danger æŒ‰é’® - å±é™©æ“ä½œ */
        .btn-danger {
            background: #ff4d4f;
            border-color: #ff4d4f;
            color: #fff;
        }

        .btn-danger:hover:not(:disabled) {
            background: #ff7875;
            border-color: #ff7875;
        }

        .btn-danger:active:not(:disabled) {
            background: #cf1322;
            border-color: #cf1322;
        }

        /* Large æŒ‰é’® */
        .btn-large {
            height: 40px;
            padding: 6.4px 15px;
            font-size: 16px;
        }

        /* Small æŒ‰é’® */
        .btn-small {
            height: 24px;
            padding: 0px 7px;
            font-size: 14px;
        }

        /* æŒ‰é’®ç»„ */
        .btn-group {
            display: inline-flex;
            gap: 8px;
        }

        /* å†…å®¹å½•å…¥é¡µé¢ */
        .input-section {
            margin-bottom: 30px;
        }

        .input-label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .textarea-input {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .textarea-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .platform-select {
            margin-top: 20px;
        }

        .platform-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .platform-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .platform-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .platform-checkbox label {
            cursor: pointer;
            font-size: 15px;
            color: #333;
        }

        .submit-section {
            margin-top: 30px;
            display: flex;
            justify-content: center;
        }

        .btn-large {
            padding: 15px 40px;
            font-size: 18px;
            font-weight: 600;
        }

        /* å†…å®¹åˆ†æé¡µé¢ */
        .analysis-result {
            margin-top: 30px;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #f0f0f0;
        }

        .result-title {
            font-size: 20px;
            font-weight: 600;
            color: rgba(0, 0, 0, 0.85);
            line-height: 32px;
        }

        .result-actions {
            display: inline-flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .original-content {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            line-height: 1.8;
            font-size: 15px;
            color: #333;
            white-space: pre-wrap;
            word-wrap: break-word;
            height: calc(100vh - 400px);
            min-height: 500px;
            max-height: 800px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .original-content::-webkit-scrollbar {
            width: 8px;
        }

        .original-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .original-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .original-content::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .suggestions-list {
            margin-top: 30px;
            height: calc(100vh - 400px);
            min-height: 500px;
            max-height: 800px;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 10px;
            border: 1px solid #f0f0f0;
            border-radius: 8px;
            background: #fafafa;
        }

        .suggestions-list::-webkit-scrollbar {
            width: 8px;
        }

        .suggestions-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .suggestions-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .suggestions-list::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .suggestion-item {
            background: #fff;
            border-left: 4px solid #667eea;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .suggestion-item.qualification-first {
            border-left-color: #f56565;
            background: #fff5f5;
        }

        .suggestion-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .suggestion-item.collapsed {
            padding: 12px 16px;
        }

        .suggestion-item.collapsed .suggestion-details {
            display: none;
        }

        .suggestion-item.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        .suggestion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .suggestion-title-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .collapse-icon {
            font-size: 12px;
            color: #999;
            transition: transform 0.3s;
            user-select: none;
        }

        .suggestion-title {
            font-size: 15px;
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .suggestion-details {
            margin-top: 12px;
        }

        .qualification-badge {
            background: #f56565;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }

        .rule-tag {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .tag-qualification {
            background: #fee;
            color: #c53030;
        }

        .tag-legal {
            background: #e6f3ff;
            color: #2c5282;
        }

        .tag-company {
            background: #f0fff4;
            color: #22543d;
        }

        .tag-business {
            background: #fffaf0;
            color: #744210;
        }

        .rule-interpretation {
            background: #f5f5f5;
            padding: 10px 12px;
            border-radius: 4px;
            margin-bottom: 10px;
            color: #666;
            line-height: 1.6;
            font-size: 13px;
            border-left: 3px solid #1890ff;
        }

        .replacement-words {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .replacement-words strong {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-size: 13px;
        }

        .replacement-word-item {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 24px;
            padding: 0 8px;
            margin-right: 8px;
            margin-bottom: 8px;
            font-size: 12px;
            background: #fff;
            border: 1px solid #1890ff;
            color: #1890ff;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);
            white-space: nowrap;
        }

        .replacement-word-item:hover {
            background: #1890ff;
            color: #fff;
            border-color: #1890ff;
        }

        .replacement-word-item:active {
            transform: translateY(1px);
        }

        .modified-content {
            background: #d4edda;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            line-height: 1.8;
            font-size: 16px;
        }

        .highlight {
            background: #c8e6c9;
            color: #2e7d32;
            padding: 2px 4px;
            border-radius: 4px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes highlightPulse {
            0%, 100% { background-color: transparent; }
            50% { background-color: #e6f7ff; }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
            }

            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .page-content {
                padding: 20px;
            }

            .result-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .result-actions {
                width: 100%;
                flex-direction: column;
            }

            .result-actions .btn {
                width: 100%;
            }

            .comparison-view {
                grid-template-columns: 1fr;
            }

            #review-original-tab > div {
                grid-template-columns: 1fr !important;
            }

            .original-content,
            .suggestions-list {
                height: 400px !important;
                min-height: 300px !important;
                max-height: 500px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="header">
            <div class="logo">ğŸ›¡ï¸ åˆè§„æ™ºèƒ½ä½“</div>
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchPage('input')">å†…å®¹å½•å…¥</button>
                <button class="nav-tab" onclick="switchPage('analysis')">å†…å®¹åˆ†æ</button>
                <button class="nav-tab" onclick="switchPage('knowledge')">çŸ¥è¯†åº“ä¸Šä¼ </button>
            </div>
        </div>

        <!-- å†…å®¹å½•å…¥é¡µé¢ -->
        <div class="page-content active" id="input-page">
            <h2 class="page-title">å†…å®¹å½•å…¥</h2>
            <p class="page-desc">è¾“å…¥éœ€è¦å®¡æ ¸çš„å†…å®¹ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è¿›è¡Œåˆè§„æ€§åˆ†æå’Œå®¡æ ¸</p>
            
            <div class="input-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <label class="input-label" style="margin-bottom: 0;">è¯·è¾“å…¥éœ€è¦å®¡æ ¸çš„å†…å®¹ï¼š</label>
                    <div style="display: flex; gap: 8px;">
                        <label class="btn btn-default" style="margin: 0; cursor: pointer;">
                            <span style="margin-right: 4px;">ğŸ“„</span>å¯¼å…¥æ–‡æ¡£
                            <input type="file" id="doc-input" class="file-input" accept=".doc,.docx,.pdf,.txt" style="display: none;" onchange="handleDocImport(event)">
                        </label>
                    </div>
                </div>
                <textarea class="textarea-input" id="content-input" placeholder="åœ¨æ­¤è¾“å…¥éœ€è¦å®¡æ ¸çš„æ–‡æœ¬å†…å®¹ï¼Œæˆ–ç‚¹å‡»ä¸Šæ–¹"å¯¼å…¥æ–‡æ¡£"æŒ‰é’®å¯¼å…¥Wordã€PDFã€TXTæ ¼å¼æ–‡æ¡£...">å¤©ä¹ç½‘ç§‘ä¼ä¸šæ•°å­—åŒ–è½¬å‹æœåŠ¡
ã€å¼•é¢†æœªæ¥,æ™ºåˆ›ä»·å€¼ã€‘
é€‰æ‹©å¤©ä¹ç½‘ç§‘ï¼Œå°±æ˜¯é€‰æ‹©æœ€å¥½çš„æ•°å­—åŒ–è½¬å‹æœåŠ¡ã€‚æˆ‘ä»¬æ‹¥æœ‰ç¬¬ä¸€çš„è¡Œä¸šåœ°ä½ï¼Œä¸ºå®¢æˆ·æä¾›æœ€ä¸“ä¸šçš„åŒ»ç–—å¥åº·ç®¡ç†è§£å†³æ–¹æ¡ˆå’Œé‡‘èç§‘æŠ€æœåŠ¡ã€‚ä¼ä¸šè½¬å‹ä¹‹è·¯å……æ»¡æœªçŸ¥é£é™©ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠ•èµ„ç†è´¢å®ç°å¿«é€Ÿç›ˆåˆ©ã€‚</textarea>
                <div id="doc-import-status" style="display: none; margin-top: 10px; padding: 10px; background: #e6f7ff; border: 1px solid #91d5ff; border-radius: 4px; font-size: 14px; color: #1890ff;">
                    <span id="doc-import-text"></span>
                    <button class="btn btn-danger btn-small" onclick="clearDocImport()" style="margin-left: 10px;">æ¸…é™¤</button>
                </div>
            </div>

            <div class="platform-select">
                <label class="input-label">é€‰æ‹©å‘å¸ƒå¹³å°ï¼ˆå¯é€‰ï¼‰ï¼š</label>
                <div class="platform-checkboxes">
                    <div class="platform-checkbox">
                        <input type="checkbox" id="platform-douyin" value="douyin">
                        <label for="platform-douyin">æŠ–éŸ³</label>
                    </div>
                    <div class="platform-checkbox">
                        <input type="checkbox" id="platform-xiaohongshu" value="xiaohongshu">
                        <label for="platform-xiaohongshu">å°çº¢ä¹¦</label>
                    </div>
                    <div class="platform-checkbox">
                        <input type="checkbox" id="platform-wechat" value="wechat">
                        <label for="platform-wechat">å¾®ä¿¡</label>
                    </div>
                    <div class="platform-checkbox">
                        <input type="checkbox" id="platform-weibo" value="weibo">
                        <label for="platform-weibo">å¾®åš</label>
                    </div>
                </div>
            </div>

            <div class="submit-section">
                <button class="btn btn-primary btn-large" onclick="submitContent()">å¼€å§‹å®¡æ ¸</button>
            </div>
        </div>

        <!-- å†…å®¹åˆ†æé¡µé¢ -->
        <div class="page-content" id="analysis-page">
            <h2 class="page-title">å†…å®¹åˆ†æ</h2>
            <p class="page-desc">æŸ¥çœ‹å®¡æ ¸ç»“æœå’Œä¿®æ”¹å»ºè®®</p>
            
            <div id="analysis-content">
                <div class="empty-state">
                    <div class="empty-icon">ğŸ“</div>
                    <p>æš‚æ— å®¡æ ¸ç»“æœï¼Œè¯·å…ˆåœ¨"å†…å®¹å½•å…¥"é¡µé¢æäº¤å†…å®¹è¿›è¡Œå®¡æ ¸</p>
                </div>
            </div>
        </div>

        <!-- çŸ¥è¯†åº“ä¸Šä¼ é¡µé¢ -->
        <div class="page-content" id="knowledge-page">
            <h2 class="page-title">çŸ¥è¯†åº“ä¸Šä¼ </h2>
            <p class="page-desc">ä¸Šä¼ åˆè§„çŸ¥è¯†åº“æ–‡ä»¶ï¼Œæ”¯æŒéšæ—¶æ›´æ–°ã€‚æ”¯æŒæ ¼å¼ï¼šPDFã€Wordã€TXTç­‰æ–‡æ¡£æ ¼å¼</p>
            
            <div class="input-section">
                <label class="input-label">é€‰æ‹©åˆ†ç±»æ ‡ç­¾ï¼š</label>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; margin-top: 10px;">
                    <label class="category-tag">
                        <input type="radio" name="category" value="qualification" checked>
                        <span>èµ„è´¨å®¡æ ¸</span>
                    </label>
                    <label class="category-tag">
                        <input type="radio" name="category" value="legal">
                        <span>å›½å®¶æ³•å¾‹</span>
                    </label>
                    <label class="category-tag">
                        <input type="radio" name="category" value="platform">
                        <span>å¹³å°è§„åˆ™</span>
                    </label>
                    <label class="category-tag">
                        <input type="radio" name="category" value="company">
                        <span>å…¬å¸è§„åˆ™</span>
                    </label>
                    <label class="category-tag">
                        <input type="radio" name="category" value="business">
                        <span>ä¸šåŠ¡è§„åˆ™</span>
                    </label>
                </div>
            </div>

            <div class="upload-section">
                <div class="upload-area" id="upload-area" onclick="document.getElementById('file-input').click()">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </div>
                    <div class="upload-hint">æ”¯æŒ PDFã€Wordã€TXT ç­‰æ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 50MB</div>
                </div>
                <input type="file" id="file-input" class="file-input" multiple accept=".pdf,.doc,.docx,.txt,.md">
                
                <div class="file-list" id="file-list"></div>
            </div>

            <div class="submit-section">
                <button class="btn btn-primary btn-large" onclick="uploadFiles()">ä¸Šä¼ æ–‡ä»¶</button>
            </div>
        </div>

    </div>

    <script>
        // å­˜å‚¨ä¸Šä¼ çš„æ–‡ä»¶
        let uploadedFiles = [];
        // å­˜å‚¨å®¡æ ¸ç»“æœ
        let auditResult = null;
        // å­˜å‚¨ä¿®æ”¹åçš„å†…å®¹
        let modifiedContent = '';
        // å­˜å‚¨å¯¼å…¥çš„æ–‡æ¡£
        let importedDoc = null;

        // é¡µé¢åˆ‡æ¢
        function switchPage(pageId) {
            // æ›´æ–°å¯¼èˆªæ ‡ç­¾
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // æ›´æ–°é¡µé¢å†…å®¹
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId + '-page').classList.add('active');
        }

        // æ–‡ä»¶ä¸Šä¼ ç›¸å…³
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const fileList = document.getElementById('file-list');

        // æ‹–æ‹½ä¸Šä¼ 
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files);
            handleFiles(files);
        });

        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleFiles(files);
        });

        function handleFiles(files) {
            files.forEach(file => {
                if (!uploadedFiles.find(f => f.name === file.name)) {
                    uploadedFiles.push(file);
                    renderFileItem(file);
                }
            });
        }

        function renderFileItem(file) {
            const selectedCategory = document.querySelector('input[name="category"]:checked');
            const categoryName = selectedCategory ? selectedCategory.value : 'æœªåˆ†ç±»';
            const categoryNames = {
                'qualification': 'èµ„è´¨å®¡æ ¸',
                'legal': 'å›½å®¶æ³•å¾‹',
                'platform': 'å¹³å°è§„åˆ™',
                'company': 'å…¬å¸è§„åˆ™',
                'business': 'ä¸šåŠ¡è§„åˆ™'
            };
            
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.innerHTML = `
                <div class="file-info">
                    <div class="file-icon">ğŸ“„</div>
                    <div class="file-details">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)} | åˆ†ç±»ï¼š${categoryNames[categoryName] || 'æœªåˆ†ç±»'}</div>
                    </div>
                </div>
                <div class="file-actions">
                    <button class="btn btn-danger btn-small" onclick="removeFile('${file.name}')">åˆ é™¤</button>
                </div>
            `;
            fileList.appendChild(fileItem);
        }

        function removeFile(fileName) {
            uploadedFiles = uploadedFiles.filter(f => f.name !== fileName);
            fileList.innerHTML = '';
            uploadedFiles.forEach(file => renderFileItem(file));
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function uploadFiles() {
            if (uploadedFiles.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼');
                return;
            }

            // è·å–é€‰ä¸­çš„åˆ†ç±»
            const selectedCategory = document.querySelector('input[name="category"]:checked');
            if (!selectedCategory) {
                alert('è¯·é€‰æ‹©åˆ†ç±»æ ‡ç­¾ï¼');
                return;
            }

            const categoryName = selectedCategory.value;
            const categoryNames = {
                'qualification': 'èµ„è´¨å®¡æ ¸',
                'legal': 'å›½å®¶æ³•å¾‹',
                'platform': 'å¹³å°è§„åˆ™',
                'company': 'å…¬å¸è§„åˆ™',
                'business': 'ä¸šåŠ¡è§„åˆ™'
            };

            // æ¨¡æ‹Ÿä¸Šä¼ è¿‡ç¨‹
            const loadingHtml = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨ä¸Šä¼ æ–‡ä»¶åˆ°"${categoryNames[categoryName]}"åˆ†ç±»...</p>
                </div>
            `;
            fileList.innerHTML = loadingHtml;

            // æ¨¡æ‹Ÿä¸Šä¼ æˆåŠŸ
            setTimeout(() => {
                alert(`æˆåŠŸä¸Šä¼  ${uploadedFiles.length} ä¸ªæ–‡ä»¶åˆ°"${categoryNames[categoryName]}"åˆ†ç±»ï¼çŸ¥è¯†åº“å·²æ›´æ–°ã€‚`);
                uploadedFiles = [];
                fileList.innerHTML = '';
                fileInput.value = '';
            }, 2000);
        }

        // å¤„ç†æ–‡æ¡£å¯¼å…¥
        function handleDocImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            // é™åˆ¶å•æ–‡æ¡£å¯¼å…¥
            if (event.target.files.length > 1) {
                alert('ä»…æ”¯æŒå•æ–‡æ¡£å¯¼å…¥ï¼Œè¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶ï¼');
                event.target.value = '';
                return;
            }

            const fileName = file.name;
            const fileExtension = fileName.split('.').pop().toLowerCase();
            
            if (!['doc', 'docx', 'pdf', 'txt'].includes(fileExtension)) {
                alert('ä»…æ”¯æŒ Word (.doc, .docx)ã€PDF (.pdf) å’Œ TXT (.txt) æ ¼å¼ï¼');
                event.target.value = '';
                return;
            }

            importedDoc = file;
            
            // æ˜¾ç¤ºå¯¼å…¥çŠ¶æ€
            document.getElementById('doc-import-status').style.display = 'block';
            document.getElementById('doc-import-text').textContent = `å·²å¯¼å…¥ï¼š${fileName} (${formatFileSize(file.size)})`;

            // è¯»å–æ–‡ä»¶å†…å®¹
            if (fileExtension === 'txt') {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('content-input').value = e.target.result;
                };
                reader.readAsText(file, 'UTF-8');
            } else if (fileExtension === 'pdf') {
                // PDFå¤„ç†éœ€è¦pdf.jsåº“
                extractTextFromPDF(file);
            } else if (fileExtension === 'doc' || fileExtension === 'docx') {
                // Wordæ–‡æ¡£å¤„ç†éœ€è¦mammoth.jsåº“
                extractTextFromWord(file);
            }
        }

        // æ¸…é™¤æ–‡æ¡£å¯¼å…¥
        function clearDocImport() {
            importedDoc = null;
            document.getElementById('doc-input').value = '';
            document.getElementById('doc-import-status').style.display = 'none';
            document.getElementById('content-input').value = '';
        }

        // ä»PDFæå–æ–‡æœ¬
        function extractTextFromPDF(file) {
            // åŠ¨æ€åŠ è½½pdf.js
            if (typeof window.pdfjsLib === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js';
                script.onload = function() {
                    window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                    readPDF(file);
                };
                document.head.appendChild(script);
            } else {
                readPDF(file);
            }
        }

        function readPDF(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const typedArray = new Uint8Array(e.target.result);
                window.pdfjsLib.getDocument(typedArray).promise.then(function(pdf) {
                    let text = '';
                    const numPages = pdf.numPages;
                    let pagePromises = [];
                    
                    for (let pageNum = 1; pageNum <= numPages; pageNum++) {
                        pagePromises.push(
                            pdf.getPage(pageNum).then(function(page) {
                                return page.getTextContent().then(function(textContent) {
                                    return textContent.items.map(item => item.str).join(' ');
                                });
                            })
                        );
                    }
                    
                    Promise.all(pagePromises).then(function(texts) {
                        text = texts.join('\n\n');
                        document.getElementById('content-input').value = text;
                    });
                }).catch(function(error) {
                    console.error('PDFè¯»å–å¤±è´¥ï¼š', error);
                    alert('PDFæ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼');
                });
            };
            reader.readAsArrayBuffer(file);
        }

        // ä»Wordæå–æ–‡æœ¬
        function extractTextFromWord(file) {
            // åŠ¨æ€åŠ è½½mammoth.js
            if (typeof window.mammoth === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js';
                script.onload = function() {
                    readWord(file);
                };
                script.onerror = function() {
                    alert('Wordæ–‡æ¡£å¤„ç†åº“åŠ è½½å¤±è´¥ï¼Œè¯·ä½¿ç”¨TXTæ ¼å¼æˆ–æ‰‹åŠ¨è¾“å…¥å†…å®¹ï¼');
                };
                document.head.appendChild(script);
            } else {
                readWord(file);
            }
        }

        function readWord(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const arrayBuffer = e.target.result;
                window.mammoth.extractRawText({ arrayBuffer: arrayBuffer })
                    .then(function(result) {
                        document.getElementById('content-input').value = result.value;
                    })
                    .catch(function(error) {
                        console.error('Wordè¯»å–å¤±è´¥ï¼š', error);
                        alert('Wordæ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼');
                    });
            };
            reader.readAsArrayBuffer(file);
        }

        // æäº¤å†…å®¹å®¡æ ¸
        function submitContent() {
            const content = document.getElementById('content-input').value.trim();
            if (!content) {
                alert('è¯·è¾“å…¥éœ€è¦å®¡æ ¸çš„å†…å®¹ï¼');
                return;
            }

            // åˆ‡æ¢åˆ°åˆ†æé¡µé¢
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab')[1].classList.add('active');
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById('analysis-page').classList.add('active');

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('analysis-content').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨åˆ†æå†…å®¹ï¼Œè¯·ç¨å€™...</p>
                </div>
            `;

            // æ¨¡æ‹Ÿå®¡æ ¸è¿‡ç¨‹ï¼ˆå®é™…åº”è¯¥è°ƒç”¨APIï¼‰
            setTimeout(() => {
                performAudit(content);
            }, 1500);
        }

        // æ‰§è¡Œå®¡æ ¸åˆ†æ
        function performAudit(content) {
            // æ¨¡æ‹Ÿå®¡æ ¸ç»“æœï¼ˆå®é™…åº”è¯¥è°ƒç”¨Coze APIï¼‰
            const suggestions = analyzeContent(content);
            
            auditResult = {
                original: content,
                suggestions: suggestions,
                modified: applySuggestions(content, suggestions)
            };

            modifiedContent = auditResult.modified;
            renderAnalysisResult();
        }

        // åˆ†æå†…å®¹ï¼ˆæ¨¡æ‹Ÿï¼Œå®é™…åº”è°ƒç”¨Coze APIï¼‰
        function analyzeContent(content) {
            const suggestions = [];
            
            // èµ„è´¨å®¡æ ¸ï¼ˆä¼˜å…ˆï¼‰
            if (content.includes('åŒ»ç–—') || content.includes('æ²»ç–—') || content.includes('è¯Šæ–­')) {
                suggestions.push({
                    id: 'qual-1',
                    type: 'qualification',
                    priority: 'critical',
                    title: 'èµ„è´¨å®¡æ ¸ï¼šæ— åŒ»ç–—èµ„è´¨',
                    rule: 'æˆ‘å…¬å¸æ— åŒ»ç–—ç›¸å…³èµ„è´¨/ç‰Œç…§ï¼Œå› æ­¤ä¸èƒ½æåŠåŒ»ç–—ç›¸å…³å†…å®¹ã€‚',
                    keywords: ['åŒ»ç–—', 'æ²»ç–—', 'è¯Šæ–­'],
                    replacements: ['å¥åº·', 'ä¿å¥', 'æ”¯æŒ']
                });
            }

            if (content.includes('é‡‘è') || content.includes('ç†è´¢') || content.includes('æŠ•èµ„')) {
                suggestions.push({
                    id: 'qual-2',
                    type: 'qualification',
                    priority: 'critical',
                    title: 'èµ„è´¨å®¡æ ¸ï¼šæ— é‡‘èèµ„è´¨',
                    rule: 'æˆ‘å…¬å¸æ— é‡‘èç›¸å…³èµ„è´¨/ç‰Œç…§ï¼Œå› æ­¤ä¸èƒ½æåŠé‡‘èç›¸å…³å†…å®¹ã€‚',
                    keywords: ['é‡‘è', 'ç†è´¢', 'æŠ•èµ„'],
                    replacements: ['ç§‘æŠ€æœåŠ¡', 'æŠ€æœ¯æœåŠ¡', 'æ•°å­—åŒ–æœåŠ¡']
                });
            }

            // å†…å®¹å®¡æ ¸
            if (content.includes('æœ€å¥½') || content.includes('æœ€ä½³') || content.includes('ç¬¬ä¸€')) {
                suggestions.push({
                    id: 'content-1',
                    type: 'legal',
                    priority: 'high',
                    title: 'ç»å¯¹åŒ–ç”¨è¯­ç¦æ­¢',
                    rule: 'å¹¿å‘Šä¸­ä¸¥ç¦ä½¿ç”¨"æœ€é«˜çº§"ã€"æœ€ä½³"ã€"æœ€å¥½"ã€"ç¬¬ä¸€"ç­‰ç»å¯¹åŒ–ç”¨è¯­ã€‚',
                    keywords: ['æœ€å¥½', 'æœ€ä½³', 'ç¬¬ä¸€'],
                    replacements: ['ä¼˜è´¨çš„', 'ä¸“ä¸šçš„', 'é¢†å…ˆçš„']
                });
            }

            if (content.includes('é£é™©') || content.includes('æœªçŸ¥')) {
                suggestions.push({
                    id: 'content-2',
                    type: 'company',
                    priority: 'normal',
                    title: 'é¿å…ç„¦è™‘è¡¨è¿°',
                    rule: 'é¿å…ä½¿ç”¨å¯èƒ½å¼•èµ·ç„¦è™‘çš„è¡¨è¿°ï¼Œå¦‚"é£é™©"ã€"æœªçŸ¥"ç­‰ã€‚',
                    keywords: ['é£é™©', 'æœªçŸ¥'],
                    replacements: ['éœ€è¦é™ªä¼´', 'å…±åŒæˆé•¿', 'ç§¯æé¢å¯¹']
                });
            }

            return suggestions;
        }

        // åº”ç”¨å»ºè®®ç”Ÿæˆä¿®æ”¹åå†…å®¹
        function applySuggestions(content, suggestions) {
            let modified = content;
            suggestions.forEach(suggestion => {
                suggestion.keywords.forEach((keyword, index) => {
                    if (suggestion.replacements[index]) {
                        modified = modified.replace(new RegExp(keyword, 'g'), suggestion.replacements[index]);
                    }
                });
            });
            return modified;
        }

        // æ¸²æŸ“åˆ†æç»“æœ
        function renderAnalysisResult() {
            if (!auditResult) {
                document.getElementById('analysis-content').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“</div>
                        <p>æš‚æ— å®¡æ ¸ç»“æœ</p>
                    </div>
                `;
                return;
            }

            // æŒ‰ä¼˜å…ˆçº§æ’åºï¼šèµ„è´¨å®¡æ ¸ä¼˜å…ˆ
            const sortedSuggestions = [...auditResult.suggestions].sort((a, b) => {
                const priorityOrder = { 'critical': 1, 'high': 2, 'normal': 3 };
                return (priorityOrder[a.priority] || 3) - (priorityOrder[b.priority] || 3);
            });

            const suggestionsHtml = sortedSuggestions.map((suggestion, index) => {
                const isQualification = suggestion.type === 'qualification';
                const manualReplacement = suggestion.manualReplacement || '';
                const manualNote = suggestion.manualNote || '';
                // é»˜è®¤ç¬¬ä¸€ä¸ªå±•å¼€ï¼Œå…¶ä»–æŠ˜å 
                const isCollapsed = suggestion.collapsed === undefined ? (index !== 0) : suggestion.collapsed;
                return `
                    <div class="suggestion-item ${isQualification ? 'qualification-first' : ''} ${isCollapsed ? 'collapsed' : ''}" id="suggestion-${suggestion.id}" data-id="${suggestion.id}">
                        <div class="suggestion-header" onclick="toggleSuggestion('${suggestion.id}')">
                            <div class="suggestion-title-wrapper">
                                <span class="collapse-icon">â–¶</span>
                                <span class="suggestion-title">
                                    ${index + 1}. ${suggestion.title}
                                    ${isQualification ? '<span class="qualification-badge">ä¼˜å…ˆ</span>' : ''}
                                </span>
                            </div>
                            <span class="rule-tag tag-${suggestion.type}">
                                ${suggestion.type === 'qualification' ? 'èµ„è´¨å®¡æ ¸' : 
                                  suggestion.type === 'legal' ? 'æ³•å¾‹è§„åˆ™' : 
                                  suggestion.type === 'company' ? 'å…¬å¸è§„åˆ™' : 'ä¸šåŠ¡è§„åˆ™'}
                            </span>
                        </div>
                        <div class="suggestion-details">
                            <div class="rule-interpretation">
                                <strong>è§„åˆ™è§£è¯»ï¼š</strong>${suggestion.rule}
                            </div>
                            <div class="replacement-words">
                                <strong>æ›¿æ¢è¯å»ºè®®ï¼š</strong>
                                ${suggestion.replacements.map(replacement => 
                                    `<span class="replacement-word-item" onclick="event.stopPropagation(); applyReplacement('${suggestion.id}', '${replacement}')">${replacement}</span>`
                                ).join('')}
                            </div>
                            <div class="manual-edit-section">
                                <strong>æ‰‹åŠ¨è¾“å…¥æ›¿ä»£è¯ï¼š</strong>
                                <input type="text" class="manual-edit-input" id="manual-replace-${suggestion.id}" 
                                    placeholder="æ‰‹åŠ¨è¾“å…¥æ›¿ä»£è¯" value="${manualReplacement}"
                                    onchange="updateManualReplacement('${suggestion.id}', this.value)"
                                    onclick="event.stopPropagation();">
                                <button class="btn btn-primary btn-small" onclick="event.stopPropagation(); applyManualReplacement('${suggestion.id}')" style="margin-top: 5px;">åº”ç”¨æ›¿ä»£è¯</button>
                            </div>
                            <div class="manual-edit-section" style="margin-top: 10px;">
                                <strong>å®¡æ ¸è¡¥å……æ„è§ï¼š</strong>
                                <textarea class="manual-edit-textarea" id="manual-note-${suggestion.id}" 
                                    placeholder="è¡¥å……å®¡æ ¸æ„è§ï¼ˆå¯é€‰ï¼‰" onclick="event.stopPropagation();">${manualNote}</textarea>
                                <button class="btn btn-default btn-small" onclick="event.stopPropagation(); saveManualNote('${suggestion.id}')" style="margin-top: 5px;">ä¿å­˜æ„è§</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // åŸæ–‡å†…å®¹é«˜äº®ï¼šæ˜¾ç¤ºè¿è§„è¯ï¼ˆçº¢è‰²ï¼‰å’Œå·²åº”ç”¨çš„æ›¿æ¢ï¼ˆç»¿è‰²ï¼‰
            // ä»åŸæ–‡å¼€å§‹ï¼Œå·²æ›¿æ¢çš„è¯æ˜¾ç¤ºä¸ºç»¿è‰²ï¼ˆæ›¿æ¢åçš„è¯ï¼‰ï¼Œæœªæ›¿æ¢çš„è¿è§„è¯æ˜¾ç¤ºä¸ºçº¢è‰²
            const highlightedOriginal = highlightKeywords(auditResult.original, sortedSuggestions);
            // ä¿®æ”¹åå†…å®¹é«˜äº®ï¼šæ˜¾ç¤ºå·²ä¿®æ”¹çš„éƒ¨åˆ†ï¼ˆç»¿è‰²ï¼‰
            const highlightedModified = highlightModifiedContent(auditResult.modified, sortedSuggestions);

            document.getElementById('analysis-content').innerHTML = `
                <div class="analysis-result">
                    <div class="result-header">
                        <div class="result-title">å®¡æ ¸ç»“æœ</div>
                        <div class="result-actions btn-group">
                            <button class="btn btn-default" onclick="copyContent()">
                                <span style="margin-right: 4px;">ğŸ“‹</span>å¤åˆ¶ä¿®æ”¹åå†…å®¹
                            </button>
                            <button class="btn btn-success" onclick="exportWord()">
                                <span style="margin-right: 4px;">ğŸ“„</span>å¯¼å‡ºWord
                            </button>
                            <button class="btn btn-primary" onclick="exportReport()">
                                <span style="margin-right: 4px;">ğŸ“¥</span>å¯¼å‡ºæŠ¥å‘Š
                            </button>
                        </div>
                    </div>

                    <!-- æ ‡ç­¾é¡µï¼šå®¡æ ¸å»ºè®®/å¯¹æ¯”è§†å›¾ -->
                    <div class="tabs">
                        <button class="tab active" onclick="switchReviewTab('original', this)">å®¡æ ¸å»ºè®®</button>
                        <button class="tab" onclick="switchReviewTab('comparison', this)">å¯¹æ¯”æŸ¥çœ‹</button>
                        <button class="tab" onclick="switchReviewTab('modified', this)">ä¿®æ”¹åå†…å®¹</button>
                    </div>

                    <!-- å®¡æ ¸å»ºè®®æ ‡ç­¾é¡µ -->
                    <div class="tab-content active" id="review-original-tab">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                            <div>
                                <h4 style="margin-bottom: 15px;">åŸæ–‡å†…å®¹ <span style="font-size: 12px; color: #999;">(çº¢è‰²è¡¨ç¤ºè¿è§„è¯ï¼Œç»¿è‰²è¡¨ç¤ºå·²ä¿®æ”¹ï¼Œç‚¹å‡»å¯å®šä½åˆ°å®¡æ ¸å»ºè®®)</span></h4>
                                <div class="original-content" id="original-content-text">
                                    ${highlightedOriginal}
                                </div>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 15px;">å®¡æ ¸å»ºè®® <span style="font-size: 12px; color: #999;">(æŒ‰ä¼˜å…ˆçº§æ’åº)</span></h4>
                                <div class="suggestions-list" id="suggestions-list">
                                    ${suggestionsHtml}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å¯¹æ¯”æŸ¥çœ‹æ ‡ç­¾é¡µ -->
                    <div class="tab-content" id="review-comparison-tab">
                        <div class="comparison-view">
                            <div class="comparison-panel original">
                                <h4>åŸæ–‡å†…å®¹</h4>
                                <div id="comparison-original">${auditResult.original}</div>
                            </div>
                            <div class="comparison-panel modified">
                                <h4>ä¿®æ”¹åå†…å®¹</h4>
                                <div id="comparison-modified">${generateComparisonView(auditResult.original, auditResult.modified, sortedSuggestions)}</div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¿®æ”¹åå†…å®¹æ ‡ç­¾é¡µ -->
                    <div class="tab-content" id="review-modified-tab">
                        <div>
                            <h4 style="margin-bottom: 15px;">ä¿®æ”¹åå†…å®¹</h4>
                            <div class="modified-content" id="modified-content-text">
                                ${highlightedModified}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // é«˜äº®å…³é”®è¯ï¼ˆåŸæ–‡å†…å®¹ä¸­æ˜¾ç¤ºï¼šçº¢è‰²=è¿è§„è¯ï¼Œç»¿è‰²=å·²åº”ç”¨çš„æ›¿æ¢ï¼‰
        // textå‚æ•°æ˜¯åŸæ–‡å†…å®¹ï¼Œéœ€è¦æ ¹æ®æ›¿æ¢çŠ¶æ€æ˜¾ç¤ºä¸åŒçš„é«˜äº®
        function highlightKeywords(text, suggestions) {
            let highlighted = text;
            const processedPositions = new Set();
            
            // å…ˆå¤„ç†å·²åº”ç”¨çš„æ›¿æ¢ï¼ˆå°†è¿è§„è¯æ›¿æ¢ä¸ºæ›¿æ¢åçš„è¯ï¼Œå¹¶æ ‡è®°ä¸ºç»¿è‰²ï¼‰
            suggestions.forEach(suggestion => {
                if (suggestion.appliedReplacement) {
                    const replacement = suggestion.appliedReplacement;
                    suggestion.keywords.forEach(keyword => {
                        // åœ¨åŸæ–‡ä¸­æ‰¾åˆ°è¿è§„è¯ï¼Œæ›¿æ¢ä¸ºæ›¿æ¢åçš„è¯å¹¶æ ‡è®°ä¸ºç»¿è‰²
                        const regex = new RegExp(keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                        highlighted = highlighted.replace(regex, (match, offset) => {
                            const position = offset + match.length;
                            if (!processedPositions.has(position)) {
                                processedPositions.add(position);
                                // æ˜¾ç¤ºæ›¿æ¢åçš„è¯ï¼ˆç»¿è‰²é«˜äº®ï¼‰
                                return `<span class="highlight-success" data-id="${suggestion.id}" onclick="scrollToSuggestion('${suggestion.id}')">${replacement}</span>`;
                            }
                            return match;
                        });
                    });
                }
            });

            // å†å¤„ç†æœªåº”ç”¨çš„è¿è§„è¯ï¼ˆçº¢è‰²é«˜äº®ï¼Œæ˜¾ç¤ºåŸè¯ï¼‰
            suggestions.forEach(suggestion => {
                if (!suggestion.appliedReplacement) {
                    suggestion.keywords.forEach(keyword => {
                        const regex = new RegExp(keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                        highlighted = highlighted.replace(regex, (match, offset) => {
                            const position = offset + match.length;
                            // æ£€æŸ¥è¿™ä¸ªä½ç½®æ˜¯å¦å·²ç»è¢«å¤„ç†è¿‡ï¼ˆå·²åº”ç”¨æ›¿æ¢ï¼‰
                            if (!processedPositions.has(position)) {
                                processedPositions.add(position);
                                const highlightClass = 'highlight-clickable';
                                return `<span class="${highlightClass}" data-id="${suggestion.id}" onclick="scrollToSuggestion('${suggestion.id}')">${match}</span>`;
                            }
                            return match;
                        });
                    });
                }
            });

            return highlighted;
        }

        // é«˜äº®ä¿®æ”¹åçš„å†…å®¹ï¼ˆæ˜¾ç¤ºå·²ä¿®æ”¹çš„éƒ¨åˆ†ä¸ºç»¿è‰²ï¼‰
        function highlightModifiedContent(text, suggestions) {
            let highlighted = text;
            const appliedReplacements = new Map();
            
            // æ”¶é›†æ‰€æœ‰å·²åº”ç”¨çš„æ›¿æ¢
            suggestions.forEach(suggestion => {
                const replacement = suggestion.appliedReplacement || (suggestion.replacements && suggestion.replacements[0]);
                if (replacement) {
                    suggestion.keywords.forEach(keyword => {
                        appliedReplacements.set(replacement, suggestion.id);
                    });
                }
            });

            // é«˜äº®æ˜¾ç¤ºå·²ä¿®æ”¹çš„éƒ¨åˆ†ï¼ˆç»¿è‰²ï¼‰
            appliedReplacements.forEach((suggestionId, replacement) => {
                if (highlighted.includes(replacement)) {
                    const regex = new RegExp(replacement.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                    highlighted = highlighted.replace(regex, `<span class="highlight-success" data-id="${suggestionId}" onclick="scrollToSuggestion('${suggestionId}')">${replacement}</span>`);
                }
            });

            return highlighted;
        }

        // æ»šåŠ¨åˆ°å¯¹åº”çš„å®¡æ ¸å»ºè®®ï¼ˆåœ¨å®¡æ ¸å»ºè®®åŒºåŸŸå†…æ»šåŠ¨ï¼‰
        function scrollToSuggestion(suggestionId) {
            const suggestionElement = document.getElementById(`suggestion-${suggestionId}`);
            const suggestionsList = document.getElementById('suggestions-list');
            
            if (suggestionElement && suggestionsList) {
                // ç§»é™¤å…¶ä»–é«˜äº®çš„activeçŠ¶æ€
                document.querySelectorAll('.highlight-clickable, .highlight-success').forEach(el => {
                    el.classList.remove('active');
                });
                
                // æ·»åŠ å½“å‰é«˜äº®çš„activeçŠ¶æ€
                document.querySelectorAll(`[data-id="${suggestionId}"]`).forEach(el => {
                    el.classList.add('active');
                });

                // å¦‚æœå»ºè®®è¢«æŠ˜å ï¼Œå…ˆå±•å¼€
                if (suggestionElement.classList.contains('collapsed')) {
                    toggleSuggestion(suggestionId, false);
                }

                // åœ¨å®¡æ ¸å»ºè®®åŒºåŸŸå†…æ»šåŠ¨
                const listRect = suggestionsList.getBoundingClientRect();
                const elementRect = suggestionElement.getBoundingClientRect();
                const scrollTop = suggestionsList.scrollTop;
                const elementOffsetTop = elementRect.top - listRect.top + scrollTop;
                
                // è®¡ç®—ç›®æ ‡æ»šåŠ¨ä½ç½®ï¼ˆå±…ä¸­æ˜¾ç¤ºï¼‰
                const targetScrollTop = elementOffsetTop - (listRect.height / 2) + (elementRect.height / 2);
                
                suggestionsList.scrollTo({
                    top: targetScrollTop,
                    behavior: 'smooth'
                });
                
                // é«˜äº®æ•ˆæœ
                suggestionElement.style.animation = 'none';
                setTimeout(() => {
                    suggestionElement.style.animation = 'highlightPulse 0.5s ease-in-out';
                }, 10);
            }
        }

        // åˆ‡æ¢å»ºè®®çš„æŠ˜å /å±•å¼€çŠ¶æ€
        function toggleSuggestion(suggestionId, toggle = true) {
            const suggestionElement = document.getElementById(`suggestion-${suggestionId}`);
            if (!suggestionElement) return;

            const suggestion = auditResult.suggestions.find(s => s.id === suggestionId);
            if (!suggestion) return;

            if (toggle) {
                suggestion.collapsed = !suggestion.collapsed;
            } else {
                suggestion.collapsed = false;
            }

            if (suggestion.collapsed) {
                suggestionElement.classList.add('collapsed');
            } else {
                suggestionElement.classList.remove('collapsed');
            }
        }

        // åº”ç”¨æ›¿æ¢è¯
        function applyReplacement(suggestionId, replacement) {
            const suggestion = auditResult.suggestions.find(s => s.id === suggestionId);
            if (!suggestion) return;

            // æ›´æ–°ä¿®æ”¹åå†…å®¹
            let modified = auditResult.original;
            auditResult.suggestions.forEach(s => {
                if (s.id === suggestionId) {
                    s.keywords.forEach(keyword => {
                        modified = modified.replace(new RegExp(keyword, 'g'), replacement);
                    });
                } else {
                    // æ£€æŸ¥æ˜¯å¦å·²ç»åº”ç”¨è¿‡æ›¿æ¢
                    const appliedReplacement = s.appliedReplacement || s.replacements[0];
                    if (appliedReplacement) {
                        s.keywords.forEach(keyword => {
                            modified = modified.replace(new RegExp(keyword, 'g'), appliedReplacement);
                        });
                    }
                }
            });

            // æ ‡è®°å·²åº”ç”¨çš„æ›¿æ¢
            suggestion.appliedReplacement = replacement;
            auditResult.modified = modified;
            modifiedContent = modified;
            renderAnalysisResult();
        }

        // å¤åˆ¶ä¿®æ”¹åå†…å®¹
        function copyContent() {
            const text = auditResult.modified || modifiedContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(() => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶');
            });
        }

        // æ›´æ–°æ‰‹åŠ¨æ›¿ä»£è¯
        function updateManualReplacement(suggestionId, value) {
            const suggestion = auditResult.suggestions.find(s => s.id === suggestionId);
            if (suggestion) {
                suggestion.manualReplacement = value;
            }
        }

        // åº”ç”¨æ‰‹åŠ¨æ›¿ä»£è¯
        function applyManualReplacement(suggestionId) {
            const input = document.getElementById(`manual-replace-${suggestionId}`);
            const replacement = input.value.trim();
            
            if (!replacement) {
                alert('è¯·è¾“å…¥æ›¿ä»£è¯ï¼');
                return;
            }

            applyReplacement(suggestionId, replacement);
            alert('æ›¿ä»£è¯å·²åº”ç”¨ï¼');
        }

        // ä¿å­˜å®¡æ ¸è¡¥å……æ„è§
        function saveManualNote(suggestionId) {
            const textarea = document.getElementById(`manual-note-${suggestionId}`);
            const note = textarea.value.trim();
            
            const suggestion = auditResult.suggestions.find(s => s.id === suggestionId);
            if (suggestion) {
                suggestion.manualNote = note;
                if (note) {
                    alert('å®¡æ ¸è¡¥å……æ„è§å·²ä¿å­˜ï¼');
                } else {
                    alert('å®¡æ ¸è¡¥å……æ„è§å·²æ¸…é™¤ï¼');
                }
            }
        }

        // å¯¼å‡ºWordæ–‡æ¡£
        function exportWord() {
            if (!auditResult || !auditResult.modified) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„å†…å®¹ï¼');
                return;
            }

            // åŠ¨æ€åŠ è½½docxåº“
            if (typeof window.docx === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/docx/7.8.2/docx.min.js';
                script.onload = function() {
                    generateWordDocument();
                };
                script.onerror = function() {
                    // å¦‚æœdocxåº“åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ
                    exportWordFallback();
                };
                document.head.appendChild(script);
            } else {
                generateWordDocument();
            }
        }

        function generateWordDocument() {
            try {
                const { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType } = window.docx;
                
                // åˆ›å»ºWordæ–‡æ¡£
                const doc = new Document({
                    sections: [{
                        properties: {},
                        children: [
                            // æ ‡é¢˜
                            new Paragraph({
                                text: "åˆè§„å®¡æ ¸ - ä¿®æ”¹åå†…å®¹",
                                heading: HeadingLevel.HEADING_1,
                                alignment: AlignmentType.CENTER,
                                spacing: { after: 400 }
                            }),
                            // å®¡æ ¸æ—¶é—´
                            new Paragraph({
                                children: [
                                    new TextRun({
                                        text: `å®¡æ ¸æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`,
                                        size: 20
                                    })
                                ],
                                spacing: { after: 300 }
                            }),
                            // ä¿®æ”¹åå†…å®¹æ ‡é¢˜
                            new Paragraph({
                                text: "ä¿®æ”¹åå†…å®¹ï¼š",
                                heading: HeadingLevel.HEADING_2,
                                spacing: { before: 200, after: 200 }
                            }),
                            // ä¿®æ”¹åå†…å®¹æ­£æ–‡
                            new Paragraph({
                                text: auditResult.modified,
                                spacing: { after: 400 },
                                alignment: AlignmentType.JUSTIFIED
                            }),
                            // å®¡æ ¸å»ºè®®æ ‡é¢˜
                            new Paragraph({
                                text: "å®¡æ ¸å»ºè®®ï¼š",
                                heading: HeadingLevel.HEADING_2,
                                spacing: { before: 200, after: 200 }
                            })
                        ]
                    }]
                });

                // æ·»åŠ å®¡æ ¸å»ºè®®
                auditResult.suggestions.forEach((suggestion, index) => {
                    doc.sections[0].children.push(
                        new Paragraph({
                            children: [
                                new TextRun({
                                    text: `${index + 1}. ${suggestion.title}`,
                                    bold: true,
                                    size: 22
                                })
                            ],
                            spacing: { before: 200, after: 100 }
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({
                                    text: `è§„åˆ™è§£è¯»ï¼š${suggestion.rule}`,
                                    size: 20
                                })
                            ],
                            spacing: { after: 100 }
                        }),
                        new Paragraph({
                            children: [
                                new TextRun({
                                    text: `æ›¿æ¢å»ºè®®ï¼š${suggestion.replacements.join('ã€')}`,
                                    size: 20
                                })
                            ],
                            spacing: { after: 200 }
                        })
                    );
                });

                // ç”Ÿæˆå¹¶ä¸‹è½½Wordæ–‡æ¡£
                Packer.toBlob(doc).then(blob => {
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `åˆè§„å®¡æ ¸_ä¿®æ”¹åå†…å®¹_${new Date().getTime()}.docx`;
                    link.click();
                    URL.revokeObjectURL(link.href);
                }).catch(error => {
                    console.error('ç”ŸæˆWordæ–‡æ¡£å¤±è´¥ï¼š', error);
                    exportWordFallback();
                });
            } catch (error) {
                console.error('ç”ŸæˆWordæ–‡æ¡£å¤±è´¥ï¼š', error);
                exportWordFallback();
            }
        }

        // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨HTMLè½¬Word
        function exportWordFallback() {
            if (!auditResult || !auditResult.modified) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„å†…å®¹ï¼');
                return;
            }

            // åˆ›å»ºHTMLå†…å®¹
            const htmlContent = `
                <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
                <head>
                    <meta charset='utf-8'>
                    <title>åˆè§„å®¡æ ¸ - ä¿®æ”¹åå†…å®¹</title>
                    <style>
                        @page {
                            size: A4;
                            margin: 2.54cm;
                        }
                        body {
                            font-family: 'Microsoft YaHei', SimSun, sans-serif;
                            font-size: 12pt;
                            line-height: 1.6;
                        }
                        h1 {
                            text-align: center;
                            font-size: 18pt;
                            margin-bottom: 20pt;
                        }
                        h2 {
                            font-size: 14pt;
                            margin-top: 20pt;
                            margin-bottom: 10pt;
                        }
                        .content {
                            text-align: justify;
                            margin-bottom: 20pt;
                        }
                        .suggestion {
                            margin-bottom: 15pt;
                        }
                        .suggestion-title {
                            font-weight: bold;
                            margin-bottom: 5pt;
                        }
                    </style>
                </head>
                <body>
                    <h1>åˆè§„å®¡æ ¸ - ä¿®æ”¹åå†…å®¹</h1>
                    <p><strong>å®¡æ ¸æ—¶é—´ï¼š</strong>${new Date().toLocaleString('zh-CN')}</p>
                    
                    <h2>ä¿®æ”¹åå†…å®¹ï¼š</h2>
                    <div class="content">${auditResult.modified.replace(/\n/g, '<br>')}</div>
                    
                    <h2>å®¡æ ¸å»ºè®®ï¼š</h2>
                    ${auditResult.suggestions.map((s, i) => `
                        <div class="suggestion">
                            <div class="suggestion-title">${i + 1}. ${s.title}</div>
                            <div>è§„åˆ™è§£è¯»ï¼š${s.rule}</div>
                            <div>æ›¿æ¢å»ºè®®ï¼š${s.replacements.join('ã€')}</div>
                        </div>
                    `).join('')}
                </body>
                </html>
            `;

            // åˆ›å»ºBlobå¹¶ä¸‹è½½
            const blob = new Blob(['\ufeff' + htmlContent], {
                type: 'application/msword'
            });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `åˆè§„å®¡æ ¸_ä¿®æ”¹åå†…å®¹_${new Date().getTime()}.doc`;
            link.click();
            URL.revokeObjectURL(link.href);
        }

        // å®¡æ ¸ç»“æœæ ‡ç­¾é¡µåˆ‡æ¢
        function switchReviewTab(tabType, element) {
            document.querySelectorAll('#analysis-page .tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('#analysis-page .tab-content').forEach(content => content.classList.remove('active'));
            
            element.classList.add('active');
            
            if (tabType === 'original') {
                document.getElementById('review-original-tab').classList.add('active');
            } else if (tabType === 'comparison') {
                document.getElementById('review-comparison-tab').classList.add('active');
                // æ›´æ–°å¯¹æ¯”è§†å›¾
                if (auditResult) {
                    const sortedSuggestions = [...auditResult.suggestions].sort((a, b) => {
                        const priorityOrder = { 'critical': 1, 'high': 2, 'normal': 3 };
                        return (priorityOrder[a.priority] || 3) - (priorityOrder[b.priority] || 3);
                    });
                    document.getElementById('comparison-modified').innerHTML = generateComparisonView(
                        auditResult.original, 
                        auditResult.modified, 
                        sortedSuggestions
                    );
                }
            } else if (tabType === 'modified') {
                document.getElementById('review-modified-tab').classList.add('active');
            }
        }


        // ç”Ÿæˆå¯¹æ¯”è§†å›¾ï¼ˆé«˜äº®ä¿®æ”¹éƒ¨åˆ†ï¼‰
        function generateComparisonView(original, modified, suggestions) {
            let result = modified;
            const appliedReplacements = {};
            
            // æ”¶é›†å·²åº”ç”¨çš„æ›¿æ¢
            suggestions.forEach(suggestion => {
                if (suggestion.appliedReplacement) {
                    suggestion.keywords.forEach(keyword => {
                        appliedReplacements[keyword] = suggestion.appliedReplacement;
                    });
                } else if (suggestion.replacements && suggestion.replacements.length > 0) {
                    suggestion.keywords.forEach((keyword, index) => {
                        if (suggestion.replacements[index]) {
                            appliedReplacements[keyword] = suggestion.replacements[index];
                        }
                    });
                }
            });

            // é«˜äº®æ˜¾ç¤ºä¿®æ”¹çš„éƒ¨åˆ†
            Object.keys(appliedReplacements).forEach(keyword => {
                const replacement = appliedReplacements[keyword];
                if (replacement && result.includes(replacement)) {
                    const regex = new RegExp(replacement.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                    result = result.replace(regex, `<span class="modified-highlight">${replacement}</span>`);
                }
            });

            return result || modified;
        }

        // å¯¼å‡ºPDFæŠ¥å‘Š
        function exportReport() {
            // åŠ¨æ€åŠ è½½jsPDFåº“
            if (typeof window.jsPDF === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                script.onload = function() {
                    generatePDF();
                };
                document.head.appendChild(script);
            } else {
                generatePDF();
            }
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });

            // è®¾ç½®ä¸­æ–‡å­—ä½“æ”¯æŒï¼ˆä½¿ç”¨é»˜è®¤å­—ä½“ï¼‰
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 20;
            let yPos = margin;

            // æ ‡é¢˜
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('åˆè§„å®¡æ ¸æŠ¥å‘Š', pageWidth / 2, yPos, { align: 'center' });
            yPos += 15;

            // å®¡æ ¸æ—¶é—´
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text(`å®¡æ ¸æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}`, margin, yPos);
            yPos += 10;

            // åŸæ–‡å†…å®¹
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('åŸæ–‡å†…å®¹ï¼š', margin, yPos);
            yPos += 8;
            
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            const originalLines = doc.splitTextToSize(auditResult.original, pageWidth - 2 * margin);
            originalLines.forEach(line => {
                if (yPos > pageHeight - 20) {
                    doc.addPage();
                    yPos = margin;
                }
                doc.text(line, margin, yPos);
                yPos += 6;
            });
            yPos += 5;

            // ä¿®æ”¹åå†…å®¹
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('ä¿®æ”¹åå†…å®¹ï¼š', margin, yPos);
            yPos += 8;
            
            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            const modifiedLines = doc.splitTextToSize(auditResult.modified, pageWidth - 2 * margin);
            modifiedLines.forEach(line => {
                if (yPos > pageHeight - 20) {
                    doc.addPage();
                    yPos = margin;
                }
                doc.text(line, margin, yPos);
                yPos += 6;
            });
            yPos += 5;

            // å®¡æ ¸å»ºè®®
            doc.setFontSize(14);
            doc.setFont(undefined, 'bold');
            doc.text('å®¡æ ¸å»ºè®®ï¼š', margin, yPos);
            yPos += 8;

            doc.setFontSize(11);
            doc.setFont(undefined, 'normal');
            auditResult.suggestions.forEach((s, i) => {
                if (yPos > pageHeight - 30) {
                    doc.addPage();
                    yPos = margin;
                }
                
                doc.setFont(undefined, 'bold');
                doc.text(`${i + 1}. ${s.title}`, margin, yPos);
                yPos += 6;
                
                doc.setFont(undefined, 'normal');
                const ruleLines = doc.splitTextToSize(`è§„åˆ™è§£è¯»ï¼š${s.rule}`, pageWidth - 2 * margin);
                ruleLines.forEach(line => {
                    if (yPos > pageHeight - 20) {
                        doc.addPage();
                        yPos = margin;
                    }
                    doc.text(line, margin + 5, yPos);
                    yPos += 6;
                });
                
                const replacementText = `æ›¿æ¢å»ºè®®ï¼š${s.replacements.join('ã€')}`;
                const replacementLines = doc.splitTextToSize(replacementText, pageWidth - 2 * margin);
                replacementLines.forEach(line => {
                    if (yPos > pageHeight - 20) {
                        doc.addPage();
                        yPos = margin;
                    }
                    doc.text(line, margin + 5, yPos);
                    yPos += 6;
                });
                
                yPos += 3;
            });

            // ä¿å­˜PDF
            doc.save(`åˆè§„å®¡æ ¸æŠ¥å‘Š_${new Date().getTime()}.pdf`);
        }
    </script>
</body>
</html>
