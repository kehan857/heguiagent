# 合规智能体 Coze 搭建方案

## 一、概述

本文档详细说明如何在 Coze 平台上搭建合规智能体，实现内容合规审核功能。智能体需要支持知识库管理、内容审核、资质审核优先等功能。

## 二、功能需求

### 2.1 核心功能
1. **知识库管理**：支持文件上传，知识库内容可随时更新
2. **内容审核**：文本输入、审核并给出修改建议
3. **资质审核优先**：特别行业先进行资质审核，再进行内容审核
4. **交互功能**：支持一键替换词、复制和导出

### 2.2 审核流程
```
输入内容 → 资质审核（优先） → 内容审核 → 生成修改建议 → 输出结果
```

## 三、Coze 智能体搭建步骤

### 3.1 创建智能体

1. 登录 Coze 平台（https://www.coze.cn/）
2. 点击「创建智能体」
3. 填写基本信息：
   - **名称**：合规智能体
   - **描述**：用于内容合规审核的智能助手，支持资质审核和内容审核
   - **头像**：选择合适的图标

### 3.2 配置知识库

#### 3.2.1 创建知识库
1. 在智能体设置中，找到「知识库」功能
2. 创建新的知识库，命名为「合规知识库」
3. 设置知识库类型：选择「文档库」

#### 3.2.2 知识库分类结构
建议按照以下三级分类组织知识库：

**一级分类：**
- 国家法律
- 平台规则
- 公司规则
- 业务规则
- **资质审核（优先）**

**二级分类示例：**
- 国家法律 → 广告法、医疗广告管理办法、互联网广告管理办法
- 平台规则 → 抖音、小红书、微信、微博
- 公司规则 → 内容审核规范、宣传规范
- 资质审核 → 医疗资质、金融资质、保险资质

**三级分类：**
- 具体规则条目，包含关键词、替换词、规则说明等

#### 3.2.3 上传知识库文件
1. 支持上传格式：PDF、Word、TXT、Markdown
2. 将合规文档按分类整理后上传
3. 支持随时更新：可以添加新文件或更新现有文件

### 3.3 配置提示词（Prompt）

#### 3.3.1 系统提示词

```
你是一个专业的合规审核助手，负责对输入的内容进行合规性审核。

## 核心审核原则

### 1. 审核流程（必须严格遵循）
**第一步：资质审核（优先执行）**
- 对于涉及医疗、金融、保险等特殊行业的内容，必须首先进行资质审核
- 检查内容中是否包含需要特定资质的表述
- 如果公司无相关资质，必须标记为违规并优先处理

**第二步：内容审核**
- 在资质审核通过后，再进行内容审核
- 检查是否符合法律法规、平台规则、公司规范等

### 2. 资质审核规则（最高优先级）

**医疗相关资质审核：**
- 关键词：医疗、治疗、诊断、处方、疗效、治愈、医疗资源等
- 规则：我公司无医疗相关资质/牌照，不能提及医疗相关内容
- 替换建议：医疗 → 健康、治疗 → 支持、诊断 → 建议

**金融相关资质审核：**
- 关键词：金融、理财、投资、保险、重疾险、基金、股票等
- 规则：我公司无金融相关资质/牌照，不能提及金融相关内容
- 替换建议：金融 → 科技服务、理财 → 服务、投资 → 支持

**保险相关资质审核：**
- 关键词：保险、重疾险、意外险、医疗保险等
- 规则：我公司无保险相关资质/牌照，不能提及保险相关内容
- 替换建议：保险 → 保障计划、重疾险 → 健康保障

### 3. 内容审核规则

**绝对化用语禁止：**
- 禁止使用：最好、最佳、第一、唯一、绝对、最高级等
- 替换建议：优质的、专业的、领先的、知名的等

**避免焦虑表述：**
- 避免使用：风险、未知、危险、恐惧、焦虑等
- 替换建议：需要陪伴、共同成长、积极面对、保驾护航等

**真实性要求：**
- 禁止夸大宣传、虚假信息
- 必须真实、准确、客观

### 4. 输出格式要求

审核结果必须按照以下JSON格式输出：

```json
{
  "hasIssues": true/false,
  "suggestions": [
    {
      "id": "唯一标识",
      "type": "qualification/legal/company/business",
      "priority": "critical/high/normal",
      "title": "问题标题",
      "rule": "规则解读说明",
      "keywords": ["关键词1", "关键词2"],
      "replacements": ["替换词1", "替换词2"],
      "originalText": "原文片段",
      "position": "位置描述"
    }
  ],
  "modifiedContent": "修改后的完整内容"
}
```

### 5. 审核优先级排序

输出建议时，必须按照以下优先级排序：
1. **critical（资质审核）** - 必须优先显示
2. **high（法律规则）** - 高优先级
3. **normal（公司规则、业务规则）** - 普通优先级

### 6. 特别说明

- 资质审核问题必须标记为 priority: "critical"
- 资质审核问题必须在输出中优先显示（排序第一）
- 如果发现资质审核问题，必须明确说明"我公司无XX资质/牌照"
- 修改建议必须提供多个替换词选项
- 所有建议必须基于知识库中的规则
```

#### 3.3.2 用户提示词模板

```
请对以下内容进行合规审核：

【内容】
{用户输入的内容}

【发布平台】（可选）
{用户选择的平台，如：抖音、小红书等}

请按照以下步骤审核：
1. 首先进行资质审核（检查是否涉及医疗、金融、保险等需要特殊资质的行业）
2. 然后进行内容审核（检查是否符合法律法规、平台规则、公司规范）
3. 输出审核结果和修改建议
4. 生成修改后的内容

请严格按照JSON格式输出结果。
```

### 3.4 配置插件/工具

#### 3.4.1 知识库插件
- 启用「知识库检索」插件
- 设置检索参数：
  - Top K：5-10（返回最相关的5-10条规则）
  - 相似度阈值：0.7

#### 3.4.2 文件处理插件（可选）
- 如果需要处理上传的文件，可以配置文件解析插件
- 支持PDF、Word等格式的解析

### 3.5 配置工作流（Workflow）

#### 3.5.1 审核工作流设计

```
开始
  ↓
接收用户输入
  ↓
步骤1：资质审核检查
  ├─ 检索资质审核知识库
  ├─ 检查医疗相关关键词
  ├─ 检查金融相关关键词
  └─ 检查保险相关关键词
  ↓
步骤2：内容审核检查
  ├─ 检索法律规则知识库
  ├─ 检索平台规则知识库
  ├─ 检索公司规则知识库
  └─ 检索业务规则知识库
  ↓
步骤3：生成审核建议
  ├─ 合并资质审核结果
  ├─ 合并内容审核结果
  ├─ 按优先级排序
  └─ 生成替换建议
  ↓
步骤4：生成修改后内容
  ├─ 应用替换建议
  └─ 生成最终内容
  ↓
步骤5：格式化输出
  ├─ 生成JSON格式结果
  └─ 返回给用户
  ↓
结束
```

#### 3.5.2 工作流节点配置

**节点1：资质审核节点**
- 类型：知识库检索
- 知识库：资质审核知识库
- 查询：提取医疗、金融、保险相关关键词
- 输出：资质审核结果

**节点2：内容审核节点**
- 类型：知识库检索
- 知识库：法律规则、平台规则、公司规则、业务规则
- 查询：用户输入内容
- 输出：内容审核结果

**节点3：结果合并节点**
- 类型：数据处理
- 操作：合并审核结果，按优先级排序
- 输出：排序后的审核建议列表

**节点4：内容生成节点**
- 类型：LLM调用
- 提示词：基于审核建议生成修改后内容
- 输出：修改后的完整内容

### 3.6 配置变量

在智能体设置中配置以下变量：

- `user_content`：用户输入的内容
- `platform`：发布平台（可选）
- `audit_result`：审核结果
- `modified_content`：修改后内容

### 3.7 测试与优化

#### 3.7.1 测试用例

**测试用例1：资质审核优先**
```
输入：我们提供最专业的医疗健康管理解决方案和金融科技服务。
预期：优先显示资质审核问题（医疗、金融）
```

**测试用例2：内容审核**
```
输入：选择我们，就是选择最好的服务，我们是行业第一。
预期：显示绝对化用语问题
```

**测试用例3：综合审核**
```
输入：我们提供医疗诊断服务，帮助客户通过投资理财实现快速盈利，这是最好的选择。
预期：
1. 优先显示资质审核问题（医疗、金融）
2. 显示绝对化用语问题
```

#### 3.7.2 优化建议

1. **知识库优化**
   - 定期更新知识库内容
   - 根据实际审核情况补充规则
   - 优化关键词匹配准确性

2. **提示词优化**
   - 根据实际效果调整提示词
   - 优化输出格式的准确性
   - 提高替换建议的质量

3. **工作流优化**
   - 优化检索参数
   - 调整优先级排序逻辑
   - 优化内容生成质量

## 四、API 集成方案

### 4.1 Coze API 调用

前端页面通过 Coze API 调用智能体：

```javascript
// API 调用示例
async function callCozeAPI(content, platform) {
    const response = await fetch('https://api.coze.cn/v1/chat', {
        method: 'POST',
        headers: {
            'Authorization': 'Bearer YOUR_API_KEY',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            bot_id: 'YOUR_BOT_ID',
            user_id: 'user123',
            query: `请对以下内容进行合规审核：\n${content}\n发布平台：${platform}`,
            stream: false
        })
    });
    
    const data = await response.json();
    return JSON.parse(data.answer); // 解析JSON格式的审核结果
}
```

### 4.2 前端集成

在前端页面中集成API调用：

```javascript
// 在 compliance_frontend.html 中
async function performAudit(content) {
    try {
        // 调用 Coze API
        const result = await callCozeAPI(content, getSelectedPlatforms());
        
        // 处理审核结果
        auditResult = {
            original: content,
            suggestions: result.suggestions,
            modified: result.modifiedContent
        };
        
        renderAnalysisResult();
    } catch (error) {
        console.error('审核失败：', error);
        alert('审核失败，请稍后重试');
    }
}
```

## 五、知识库文件准备

### 5.1 文件结构建议

```
合规知识库/
├── 01_资质审核/
│   ├── 医疗资质审核规则.md
│   ├── 金融资质审核规则.md
│   └── 保险资质审核规则.md
├── 02_国家法律/
│   ├── 广告法相关规则.md
│   ├── 医疗广告管理办法.md
│   └── 互联网广告管理办法.md
├── 03_平台规则/
│   ├── 抖音平台规则.md
│   ├── 小红书平台规则.md
│   └── 微信平台规则.md
└── 04_公司规则/
    ├── 内容审核规范.md
    └── 宣传内容规范.md
```

### 5.2 规则文件格式示例

**医疗资质审核规则.md**
```markdown
# 医疗资质审核规则

## 规则说明
我公司无医疗相关资质/牌照，因此不能提及医疗相关内容。

## 违规关键词
- 医疗
- 治疗
- 诊断
- 处方
- 疗效
- 治愈
- 医疗资源

## 替换建议
- 医疗 → 健康
- 治疗 → 支持
- 诊断 → 建议
- 处方 → 方案
- 疗效 → 效果
- 治愈 → 改善
- 医疗资源 → 健康支持

## 案例
原文：我们提供专业的医疗服务
修改：我们提供专业的健康服务
```

## 六、部署与维护

### 6.1 部署步骤

1. 完成智能体配置
2. 上传知识库文件
3. 测试审核功能
4. 获取 API Key 和 Bot ID
5. 在前端页面中配置 API 信息
6. 部署前端页面

### 6.2 维护计划

1. **知识库更新**
   - 每周检查新法规、新规则
   - 及时更新知识库内容
   - 根据审核反馈优化规则

2. **性能监控**
   - 监控 API 调用成功率
   - 监控审核准确率
   - 收集用户反馈

3. **持续优化**
   - 根据实际使用情况优化提示词
   - 优化知识库检索效果
   - 提升审核建议质量

## 七、注意事项

1. **资质审核必须优先**：在提示词中明确说明资质审核的优先级
2. **JSON格式输出**：确保智能体严格按照JSON格式输出，便于前端解析
3. **知识库更新**：知识库内容需要定期更新，保持规则的最新性
4. **API安全**：妥善保管API Key，不要在前端代码中暴露
5. **错误处理**：前端需要做好错误处理，API调用失败时给出友好提示

## 八、参考资源

- Coze 官方文档：https://www.coze.cn/docs
- Coze API 文档：https://www.coze.cn/open/api
- 合规相关法律法规文档（见项目文件夹）

---

**版本**：v1.0  
**更新日期**：2025-01-XX  
**维护人**：合规智能体项目组
